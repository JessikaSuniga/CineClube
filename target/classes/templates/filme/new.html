<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="head :: head"></head>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" integrity="sha512-nMNlpuaDPrqlEls3IX/Q56H36qvBASwb3ipuo3MxeWbsQB1881ox0cRv7UPTgBlriqoynt35KjEwgGUeUXIPnw==" crossorigin="anonymous" />
 
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.full.min.js" integrity="sha512-RtZU3AyMVArmHLiW0suEZ9McadTdegwbgtiQl5Qqo9kunkVg1ofwueXD8/8wv3Af8jkME3DDe3yLfR8HSJfT2g==" crossorigin="anonymous"></script>
 
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>


<body>
  <!-- 
    BARRA DE NAVEGACAO 
  -->
  
  <div th:replace="menu :: menu"></div>
  
  <!-- 
    CONTEUDO DA PAGINA 
  -->
  <main class="container">
    <div class="bg-light p-5 rounded">
      <h1>Filmes + S�ries</h1>      
      
      <div th:switch="${filme.filmeId>0}">
      	<p th:case="${true}">Atualiza��o</p>
      	<p th:case="*">Cadastro de filme</p>
      </div>

      <form th:object="${filme}" action="/filmes/save" method="POST">
      	<input type="hidden" th:field="${filme.nota}" th:if="${filme.nota}">
		<input type="hidden" th:field="${filme.filmeId}" th:if="${filme.filmeId}">
		
		<h4>Elenco:</h4>
      
		<select id="elenco" name="pessoas" th:field="*{pessoas}" multiple="multiple" class="form-control select2-single">
 			<option th:each="ator : ${filme.pessoas}"
         		th:value="${ator.pessoaId}"
         		th:text="${ator.nome}">              
 			</option>
		</select>    
	
        <div class="mb-3">
          <label class="form-label" for="nome">Nome</label> 
          
         <input type="text" th:field="*{nome}" class="form-control" placeholder="Nome do filme" th:errorclass="inputError" autocomplete="off">
         <span class="error" th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}">campo invalido</span>

        </div>
        <div class="row">
          
          <div class="col-md-6">
	          <label class="form-label" for="nome">Data lan�amento</label> 
			  <input type="text" th:field="${filme.lancamento}" class="form-control" placeholder="dd/MM/yyyy" autocomplete="off">
			  
			  <span class="error" th:if="${#fields.hasErrors('lancamento')}" 
			  th:errors="*{lancamento}">campo invalido</span>
          </div>
          
          
          <div class="col-md-6">
	          <label class="form-label" for="nome">Categoria:</label> 
      
			<select id="categoria" name="categorias" th:field="*{categoria}" multiple="multiple" class="form-control select2-single">
 				<option th:each="c : ${filme.categoria}"
         			th:value="${c.id}"
         			th:text="${c.nome}">              
 				</option>
			</select>
          </div>
          
          <select id="elenco" name="pessoas" th:field="*{pessoas}" multiple="multiple" class="form-control select2-single">
 			<option th:each="ator : ${filme.pessoas}"
         		th:value="${ator.pessoaId}"
         		th:text="${ator.nome}">              
 			</option>
		</select>   
          
        </div>
        <br/>
        <div class="mb-3">
          <p th:switch="${filme.filmeId>0}">
            <button type="submit" th:case="${true}" class="btn btn-danger" th:text="Atualizar"></button>
            <button type="submit" th:case="*" class="btn btn-primary" th:text="Adicionar"></button>
          </p>
        </div>
      </form>
    </div>
  </main>
  <script type="text/javascript" th:src="@{/js/bootstrap.bundle.min.js}"></script>
  <script>
  
  $("#elenco").select2({
	  ajax: {
	      url: '/api/elenco',
	      dataType: 'json',
	      delay: 250,
	      processResults: function (response) {
	          return {
	              results: response
	          };
	      },
	      cache: false
	  }
	 });
  
  $("#categoria").select2({
	  ajax: {
	      url: '/api/categoria',
	      dataType: 'json',
	      delay: 250,
	      processResults: function (response) {
	          return {
	              results: response
	          };
	      },
	      cache: false
	  }
	 });
  </script>
</body>
</html>